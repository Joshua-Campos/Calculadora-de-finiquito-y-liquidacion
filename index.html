<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Finiquito y Liquidaci√≥n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="calculadora.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />


</head>
<body onload="mostrarFecha()">

  <div class="page-wrapper">

  <!-- Lateral izquierdo -->
  <div class="lateral" style="background-image: url('izquierda.jpg');"></div>

  <!-- Contenedor principal -->
  <div class="container">

    <!-- Fecha y hora -->
    <div id="fecha-container">
      <p><b>Fecha:</b> <span id="fechaHoy"></span></p>
      <p><b>Hora:</b> <span id="horaHoy"></span></p>
    </div>

    <!-- T√≠tulo -->
    <h1>Calculadora de Finiquito y Liquidaci√≥n</h1>

    <!-- Formulario -->
    <form id="calcForm" onsubmit="event.preventDefault(); calcular();">

      <label for="tipoBaja">Tipo de baja:</label>
      <select id="tipoBaja" required>
        <option value="">Seleccione...</option>
        <option value="renuncia">Renuncia</option>
        <option value="despido">Despido</option>
      </select>

      <label for="fechaIngreso">Fecha de ingreso:</label>
      <input type="date" id="fechaIngreso" required>

      <label for="fechaSalida">Fecha de salida:</label>
      <input type="date" id="fechaSalida" required>

     <label for="sd">Sueldo Semanal:</label>
<input type="number" id="sd" name="sd" step="0.01">

      <label for="da">D√≠as de aguinaldo anual:</label>
      <input type="number" id="da" min="0" required>

      <label for="dvp">D√≠as de vacaciones pendientes:</label>
      <input type="number" id="dvp" min="0" required>

      <label for="pv">Prima vacacional (%):</label>
      <input type="number" id="pv" min="0" required>

      <label for="dpen">D√≠as pendientes de pago:</label>
      <input type="number" id="dpen" min="0" required>

      <button type="submit">Calcular</button>
    </form>

    <!-- Resultado -->
    <div id="resultado"></div>
    <div id="resetBtn"></div>
    
    <!-- Scripts -->
    <script>
      function mostrarFecha() {
        const hoy = new Date();
        const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById("fechaHoy").textContent = hoy.toLocaleDateString("es-ES", opciones);
        actualizarHora();
        setInterval(actualizarHora, 1000);
      }

      function actualizarHora() {
        const ahora = new Date();
        document.getElementById("horaHoy").textContent = ahora.toLocaleTimeString("es-ES");
      }

      function calcular() {
        const tipoBaja = document.getElementById("tipoBaja").value;

        // ‚úÖ Parseo seguro de fechas (evita desfase por zona horaria)
        const fiVal = document.getElementById("fechaIngreso").value;
        const fsVal = document.getElementById("fechaSalida").value;
        function parseInputDate(val) {
          if (!val) return new Date(NaN);
          const parts = val.split('-').map(Number); // ["YYYY","MM","DD"]
          return new Date(parts[0], parts[1] - 1, parts[2]); // a√±o, mesIndex, d√≠a
        }
        const FI = parseInputDate(fiVal);
        const FS = parseInputDate(fsVal);

        // Ahora el usuario ingresa sueldo semanal
        const sueldoSemanal = parseFloat(document.getElementById("sd").value);
        const SD = sueldoSemanal / 7; // sueldo diario

        const DA = parseFloat(document.getElementById("da").value);
        const DVp = parseFloat(document.getElementById("dvp").value);
        const PV = parseFloat(document.getElementById("pv").value);
        const DPen = parseFloat(document.getElementById("dpen").value);

        const hoy = new Date();
        hoy.setHours(0,0,0,0);

        // Validaciones
        if (!tipoBaja || isNaN(SD) || isNaN(DA) || isNaN(DVp) || isNaN(PV) || isNaN(DPen)) {
          document.getElementById("resultado").innerHTML = "<b>Error:</b> Todos los campos son obligatorios y deben ser n√∫meros v√°lidos.";
          mostrarBotonReiniciar();
          return;
        }

        if (!(FI instanceof Date) || isNaN(FI) || !(FS instanceof Date) || isNaN(FS)) {
          document.getElementById("resultado").innerHTML = "<b>Error:</b> Debes ingresar fechas v√°lidas.";
          mostrarBotonReiniciar();
          return;
        }

        if (FS < FI) {
          document.getElementById("resultado").innerHTML = "<b>Error:</b> La fecha de salida no puede ser anterior a la fecha de ingreso.";
          mostrarBotonReiniciar();
          return;
        }

        // Antig√ºedad
        let antig_a√±os = FS.getFullYear() - FI.getFullYear();
        const mesDiff = FS.getMonth() - FI.getMonth();
        if (mesDiff < 0 || (mesDiff === 0 && FS.getDate() < FI.getDate())) { antig_a√±os--; }
        if (antig_a√±os < 0) antig_a√±os = 0;

        // ‚úÖ Aguinaldo proporcional
        let AguinaldoProp = 0;
        if (!(FS.getDate() === 1 && FS.getMonth() === 0)) {
            const inicioAnio = new Date(FS.getFullYear(), 0, 1);
            const baseAguinaldo = FI > inicioAnio ? FI : inicioAnio;
            let dias_en_el_a√±o = Math.floor((FS - baseAguinaldo) / (1000 * 60 * 60 * 24));
            if (dias_en_el_a√±o > 0) {
                AguinaldoProp = DA * SD * (dias_en_el_a√±o / 365);
            }
        } else {
            AguinaldoProp = 0;
        }

        // ‚úÖ Tope constitucional para prima de antig√ºedad (M√©xico, art. 162 LFT)
        const salarioMinimo = 248.93; // salario m√≠nimo general 2025
        const topeSD = Math.min(SD, salarioMinimo * 2);

        // Prima de antig√ºedad (aplica si antig√ºedad >= 15 a√±os)
        const PrimaAntig = antig_a√±os >= 15 ? topeSD * 12 * antig_a√±os : 0;

        // C√°lculo de finiquito
        const Vacaciones = DVp * SD;
        const PrimaVac = Vacaciones * (PV / 100);
        const SueldoPend = SD * DPen;
        const Finiquito = Vacaciones + PrimaVac + AguinaldoProp + SueldoPend + PrimaAntig;

        let detalle = `
          <h3>Detalle de Finiquito</h3>
          Vacaciones: $${Vacaciones.toFixed(2)}<br>
          Prima vacacional: $${PrimaVac.toFixed(2)}<br>
          Aguinaldo proporcional: $${AguinaldoProp.toFixed(2)}<br>
          Sueldo pendiente: $${SueldoPend.toFixed(2)}<br>
          Prima antig√ºedad: $${PrimaAntig.toFixed(2)} ${antig_a√±os < 15 ? "(no aplica)" : ""}<br>
          <b>Total Finiquito:</b> $${Finiquito.toFixed(2)}<br>
        `;

        if (tipoBaja === "despido") {
          const Indem3m = SD * 90;
          detalle += `
            <h3>Indemnizaci√≥n por Despido</h3>
            Indemnizaci√≥n 3 meses: $${Indem3m.toFixed(2)}<br>
            <b>Total Despido:</b> $${(Finiquito + Indem3m).toFixed(2)}<br>
          `;
        }

        document.getElementById("resultado").innerHTML = detalle;
        mostrarBotonReiniciar();
      }

      function reiniciar() {
        document.getElementById("calcForm").reset();
        document.getElementById("resultado").innerHTML = "";
        document.getElementById("resetBtn").innerHTML = "";
        mostrarFecha();
      }

      function mostrarBotonReiniciar() {
        document.getElementById("resetBtn").innerHTML = `<button onclick="reiniciar()">Reiniciar</button>`;
      }
</script>
  </div>

  <!-- Lateral derecho -->
  <div class="lateral" style="background-image: url('derecha.jpg');"></div>
  </div>

<footer>
<h4 style="font-size: 24px;">CTC</h4>
        <p>‚ÄúTransparencia y claridad en tus c√°lculos laborales‚Äù</p>

  <h4>Cont√°ctanos</h4>
        <p>üìû Tel: +52 5612 5770 14</p>
        <p>‚úâÔ∏è Email: federacionmhidalgo@gmail.com</p>
    <p>&copy; 2025 Calculadora de Finiquito y Liquidaci√≥n. Todos los derechos reservados.</p>
    <p>Aviso de privacidad</p>
  </footer>

</body>
</html>

